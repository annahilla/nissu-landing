---
import Layout from '../layouts/Layout.astro';
const params = new URL(Astro.request.url).searchParams;
const userId = params.get('userId');
const secret = params.get('secret');
const apiUrl = `/api/verify-email?userId=${userId}&secret=${secret}`;
---

<Layout>
  <div class="h-[80vh] flex items-center justify-center">
    <div
      class="w-full md:w-[50rem] flex flex-col items-center justify-center gap-4 border-brown rounded-lg border-2 px-12 py-17 m-8 text-center"
    >
      <div class="text-4xl">🔐</div>
      <h1 class="text-xl font-semibold">Verifying your email</h1>
      <p id="status">Loading...</p>
    </div>
  </div>
</Layout>

<script is:inline define:vars={{ apiUrl }}>
  async function run() {
    const statusEl = document.getElementById('status');

    try {
      const res = await fetch(apiUrl);
      const data = await res.json();

      if (data.success) {
        statusEl.textContent =
          '✅ Email verified successfully. You can now return to the app and log in.';
      } else {
        statusEl.textContent = '❌ ' + data.message;
      }
    } catch (err) {
      console.error(err);
      statusEl.textContent = '❌ There was an error verifying your email.';
    }
  }

  window.addEventListener('load', run);
</script>
