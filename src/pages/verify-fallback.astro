---
import ConfigLayout from '../layouts/ConfigLayout.astro';
---

<ConfigLayout>
  <div class="text-4xl">üîê</div>
  <h1 id="title" class="text-xl font-semibold">Verifying your email...</h1>
  <p id="status">Verifying your email...</p>
</ConfigLayout>

<script is:inline>
  import { Client, Account } from 'appwrite';

  async function run() {
    const params = new URL(window.location.href).searchParams;
    const userId = params.get('userId');
    const secret = params.get('secret');
    const statusEl = document.getElementById('status');

    if (userId && secret) {
      try {
        const client = new Client()
          .setEndpoint('https://cloud.appwrite.io/v1')
          .setProject(import.meta.env.PUBLIC_APPWRITE_PROJECT_ID);

        const account = new Account(client);
        await account.updateVerification(userId, secret);

        statusEl.textContent =
          '‚úÖ Email verified successfully. You can now return to the app and log in.';
      } catch (err) {
        console.error(err);
        statusEl.textContent =
          '‚ùå There was an error verifying your email. The link may have expired.';
      }
    } else {
      statusEl.textContent = '‚ùå Invalid link.';
    }
  }

  run();
</script>
